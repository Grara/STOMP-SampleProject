# Cookie

## 정의

    서버는 유저의 브라우저에 데이터를 넣을 수 있음. 

## 동작과정

    1. 사이트에 방문하면, 브라우저는 서버에 요청을 보냄.
    2. 서버는 이에 응답하는데, 
    3. 브라우저에 저장하고자 하는 "쿠키"도 포함될 수 있음. 
    4. 다음부터 웹사이트에서 요청을 보낼 때마다, 해당 쿠키도 같이 보내짐. 

## 특징 

    1. 도메인에 따라 제한됨. 네이버가 준 쿠키는 네이버에만 보내짐.
    2. 쿠키는 서버가 정한 유효기간이 있음. 
    3. 인증 뿐 아니라, 다양한 정보를 저장할 수 있음. 
       1. 언어 설정

# Sessoin

## 정의

    기본적으로 http는 stateless.

    서버로 가는 요청들은 모두 독립적이고, 서버는 클라이언트를 특정할 수 없음. 

    이떄, 클라이언트에 관한 정보를 저장할 수 있는 것이 세션.

    주로 Redis를 세션DB로 사용

## 특징

    현재 로그인한 유저들의 모든 세션ID를 DB에 저장해야 함.

    요청이 있을 때 마다 DB와 연결해야 됨. 


## 장점 

    특정 유저를 쫓아내고 싶을 떄, 세션을 삭제하기만 하면 됨. 

    인스타그램처럼 로그인된 디바이스에서 강제 로그아웃 가능

    넷플릭스 계정 공유 제한 둘 수 있음.  

## 단점 

    세션 DB를 사고 유지해야함. 

    유저가 늘어날 수 록 DB도 늘려야 함.


## 세션과 쿠키 인증흐름

![sessioncookie](../images/Cs/cookiesession.png)

    1. http는 sateless임.
    2. 서버로 가는 모든 요청들은 각자 독립적임.
    3. 요청이 끝나면 서버는 클라이언트가 누군지 잊어버림.
    4. 이 떄, 필요한게 세션임. 
    5. 길동이가 로그인을 하면, 서버는 세션 DB에 길동이를 저장하고 고유한 세션ID를 발급.
    6. 서버는 세션ID를 쿠키에 담아 클라이언트 브라우저에 보냄. 
    7. 다음 요청부터 세션ID가 담긴 쿠키를 서버에 같이 보냄. 
    8. 서버는 해당 쿠키에 담긴 세션ID를 세션DB에서 확인하고 유저를 특정함. 
    9. 다음 페이지로 이동할 때마다, 이 프로세스가 반복됨.
    10. !!중요한 모든 유저정보는 모두 서버에 있음!! 
    11. 유저가 가지고 있는 것은 세션ID 뿐이고, 쿠키는 그저 세션ID를 전달하기 위한 매개체.
   

    12. 이러한 쿠키는 브라우저에만 있기에, 안드로이드 IOS는 토큰이란 것을 사용함. 
    13. 토큰은 String 형식.
    14. 토큰을 서버에 보내면 서버는 세션DB에서 토큰과 일치하는 유저를 찾음. 


# JWT

## 정의 

    Jason Web Token

    토큰 형식

    secret key를 사용해서 특정 정보를 가지고 JWT를 만듦.

## 특징 

    세션을 사용하면 모든 요청마다 DB와 연결하는 과정이 필요해 리소스를 너무 많이 잡아먹음. 

    토큰 형식. 

    세션DB기 필요없어짐. 

    제약이 없어서 길이가 길어도 됨. 

    유저를 인증하는데 필요한 정보를 토큰에 저장.

    JWT는 암호화 된것이 아님. 따라서, 비밀번호와 같은 민감한 정보는 담지않아야하며, secret key의 노출을 막아야 함. 

## 동작과정

    1. 홍길동이 로그인을 하면, 
    2. 서버는 유저의 ID를 가지고 특정 알고리즘을 가지고 String형태인 토큰을 만듦. 
    3. 토큰을 클라이언트에 전달.  
    4. 유저는 서버에 요청을 보낼 때 토큰을 같이 전달
    5. 서버는 토큰이 유효한지 체크.

## 장점 

    DB가 필요없음. 

    QR 체크인은 JWT방식 사용.

    facebook, google과 같은 토큰 기반 인증시스템에 접근이 용이함. 

## 단점 

    토큰이 만료되기 전까지는 강제 로그아웃기능 불가. 

    주로 Access Token의 유효기간을 짧게 하고, Refresh Token의 유효기간을 길게 둠. 

    Payload에 유저의 중요한 정보를 담아선 안됨. 